<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="reset.css">
    <title>Monopoly Game</title>
</head>
<body>
    <div style="display:flex; flex-direction:column;gap:20px;">
        <div style="font-family:'Verdana'; width:{{width|add:'220'}}px; height:auto;display:flex;justify-content:space-between;stroke-width:3;stroke:rgb(0,0,0);">
            <a href="/"><img src="https://upload.wikimedia.org/wikipedia/commons/d/df/Monopoly-Logo.svg" alt="Kiwi standing on oval"></a>
            <div style="display:flex;gap:10px;">
                <p style="display:flex;justify-content:center;align-items:center;margin:0">username: {{username}}</p>
                <a href="/logout"><button >Logout</button></a>
            </div>

        </div>

        <div style="display:flex; flex-direction: row; width:{{width|add:'220'}}px; gap:20px;">
            <svg width={{width}} height={{height}} fill="#cde6d1">
                <g>
                    <rect x={{base}} y={{base}} width={{middle_rect_size}} height={{middle_rect_size}} fill="#cde6d1" style="stroke-width:3;stroke:rgb(0,0,0)" />
                    <text x={{middle_text_loc}} y={{middle_text_loc}} transform="rotate(-45, {{middle_text_loc}}, {{middle_text_loc}})" alignment-baseline="middle" font-size="70" font-family="Verdana" stroke-width="0" stroke="#000" text-anchor="middle" fill="black">MONOPOLY</text>

                </g>
                {% for cell in cells %}
                    <g id={{cell.text}} onClick="select_cell(this.id)" >
                    {% if cell.card == "property" %}
                        {% if cell.direction == "up" %}
                                <rect x={{cell.location.0}} y={{cell.location.1}} width={{base}} height={{base}} fill="#cde6d1" style="stroke-width:3;stroke:rgb(0,0,0)" />
                                <rect x={{cell.location.0}} y={{base|add:"-20"}} width={{base}} height="20" fill={{cell.color}} style="stroke-width:2;stroke:rgb(0,0,0)" />
                                <text x={{cell.text_location.0}} y={{cell.text_location.1}}  alignment-baseline="middle" font-size="12" stroke-width="0" stroke="#000" text-anchor="middle"  font-family="Verdana" fill="black">PROPERTY  {{cell.text}}</text>
                                <text x={{cell.text_location.0}} y={{cell.text_location.1|add:"30"}}  alignment-baseline="middle" font-size="12" stroke-width="0" stroke="#000"  font-family="Verdana" fill="black">{{cell.money}}$</text>
                        {% elif cell.direction == "right" %}
                                <rect x={{cell.location.0}} y={{cell.location.1}} width={{base}} height={{base}} fill="#cde6d1" style="stroke-width:3;stroke:rgb(0,0,0)" />
                                <rect x={{cell.location.0}} y={{cell.location.1}} width={{20}} height={{base}} fill={{cell.color}} style="stroke-width:2;stroke:rgb(0,0,0)"/>
                                <text x={{cell.text_location.0}} y={{cell.text_location.1}} transform="rotate(-90, {{cell.text_location.0}}, {{cell.text_location.1}})"  alignment-baseline="middle" font-size="12" stroke-width="0" stroke="#000" text-anchor="middle"  font-family="Verdana" fill="black">PROPERTY {{cell.text}}</text>
                        {% elif cell.direction == "left" %}
                                <rect x={{cell.location.0}} y={{cell.location.1}} width={{base}} height={{base}} fill="#cde6d1" style="stroke-width:3;stroke:rgb(0,0,0)" />
                                <rect x={{base|add:"-20"}} y={{cell.location.1}} width={{20}} height={{base}} fill={{cell.color}} style="stroke-width:2;stroke:rgb(0,0,0)"/>
                                <text x={{cell.text_location.0}} y={{cell.text_location.1}} transform="rotate(90, {{cell.text_location.0}}, {{cell.text_location.1}})" alignment-baseline="middle" font-size="12" stroke-width="0" stroke="#000" text-anchor="middle"  font-family="Verdana" fill="black">PROPERTY {{cell.text}}</text>
                        {% else %}
                                <rect x={{cell.location.0}} y={{cell.location.1}} width={{base}} height={{base}} fill="#cde6d1" style="stroke-width:3;stroke:rgb(0,0,0)" />
                                <rect x={{cell.location.0}} y={{cell.location.1}} width={{base}} height="20" fill={{cell.color}} style="stroke-width:2;stroke:rgb(0,0,0)" />
                                <text x={{cell.text_location.0}} y={{cell.text_location.1}}  alignment-baseline="middle" font-size="12" stroke-width="0" stroke="#000" text-anchor="middle"  font-family="Verdana" fill="black">PROPERTY {{cell.text}}</text>
                        {% endif %}
                    {% elif cell.card == "station" %}
                            <rect x={{cell.location.0}} y={{cell.location.1}} width={{base}} height={{base}}  fill="#cde6d1"  style="stroke-width:3;stroke:rgb(0,0,0)" />
                            <text x={{cell.text_location.0}} y={{cell.text_location.1}}  alignment-baseline="middle" font-size="12" stroke-width="0" stroke="#000" text-anchor="middle"  font-family="Verdana" fill="black">STATION {{cell.direction}}</text>
                    {% elif cell.card == "start" %}
                            <rect x={{cell.location.0}} y={{cell.location.1}} width={{base}} height={{base}}  fill="#cde6d1"  style="stroke-width:3;stroke:rgb(0,0,0)" />
                            <text x={{cell.text_location.0}} y={{cell.text_location.1}}  alignment-baseline="middle" font-size="12" stroke-width="0" stroke="#000" text-anchor="middle"  font-family="Verdana" fill="black">START</text>
                    {% else %}
                            <rect x={{cell.location.0}} y={{cell.location.1}} width={{base}} height={{base}}  fill="#cde6d1" style="stroke-width:3;stroke:rgb(0,0,0)" />
                            <text x={{cell.text_location.0}} y={{cell.text_location.1}}  alignment-baseline="middle" font-size="12" stroke-width="0" stroke="#000" text-anchor="middle"  font-family="Verdana" fill="black">UNKNOWN</text>
                    {% endif %}
                    </g>
                {% endfor %}
            </svg>
            <div style="width:200px; height:auto; margin: auto; display: flex; flex-direction: column;">

                <form action="/">
                    <input type="submit" formaction="/join" value="ready">
                    <input type="submit" formaction="/join" value="detach">
                    <input type="submit" formaction="/join" value="attach">
                </form>

                <div style="padding: 8px; width: 400px; margin: 4px; margin-left: auto; display: flex; flex-direction: row;">
                    <div style="padding: 8px;">Current selected cell: </div> 
                    <div id="selected_cell" style="min-width: 20px; padding: 8px; background-color: aquamarine; text-align: center;"></div>
                </div>
                <div style="padding: 16px; width: 400px; margin: 4px; margin-left: auto;">
                    Choose one of the options below!
                </div>

                <form method="post" action="/command/{{name}}" >
                    <input type="text" name="selected_cell" id="cell">
                    {% for option in options %}
                        <input type="submit" name="option" value={{option.name}} id={{option.name}} >
                    {% endfor %}
                    {% csrf_token %}
                </form>

            </div>
        </div>

    </div>

    <script type="text/javascript">
        var selected_cell = -1;

        function select_cell(clicked_id)
        {
            selected_cell = clicked_id;
            document.getElementById('selected_cell').innerHTML = selected_cell;
            document.getElementById('cell').value = selected_cell;
        }

        function select_option(option)
        {
            if (option === "pick" || option === "teleport") {
                if (selected_cell === -1) {
                    alert("You need to choose a cell to execute this option!");
                } else {
                    alert("You " + option + "ed the cell " + selected_cell);
                }
            } else {
                alert("You chose the " + option + " option");
            }
            selected_cell = -1;
            document.getElementById('selected_cell').innerHTML = "";
            document.getElementById('cell').value = "";
            // TODO: execute option
        }

      </script>

</body>
</html>
